<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anomalize Methods • anomalize</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Anomalize Methods">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">anomalize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/anomalize_quick_start_guide.html">Anomalize Quick Start Guide</a>
    </li>
    <li>
      <a href="../articles/anomalize_methods.html">Anomalize Methods</a>
    </li>
    <li>
      <a href="../articles/forecasting_with_cleaned_anomalies.html">Reduce Forecast Error by Cleaning Anomalies</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/business-science/anomalize">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Anomalize Methods</h1>
                        <h4 class="author">Business Science</h4>
            
            <h4 class="date">2019-09-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/anomalize/blob/master/vignettes/anomalize_methods.Rmd"><code>vignettes/anomalize_methods.Rmd</code></a></small>
      <div class="hidden name"><code>anomalize_methods.Rmd</code></div>

    </div>

    
    
<p>Anomaly detection is critical to many disciplines, but possibly none more important than in <strong>time series analysis</strong>. A time series is the sequential set of values tracked over a time duration. The definition we use for an <strong>anomaly</strong> is simple: an anomaly is something that happens that (1) was unexpected or (2) was caused by an abnormal event. Therefore, the problem we intend to solve with <code>anomalize</code> is providing methods to accurately detect these “anomalous” events.</p>
<p>The methods that <code>anomalize</code> uses can be separated into two main tasks:</p>
<ol style="list-style-type: decimal">
<li>Generating Time Series Analysis Remainders</li>
<li>Detecting Anomalies in the Remainders</li>
</ol>
<div id="generating-time-series-analysis-remainders" class="section level2">
<h2 class="hasAnchor">
<a href="#generating-time-series-analysis-remainders" class="anchor"></a>1. Generating Time Series Analysis Remainders</h2>
<p>Anomaly detection is performed on <strong>remainders</strong> from a time series analysis that have had removed both:</p>
<ul>
<li>
<strong>Seasonal Components</strong>: Cyclic pattern usually occurring on a daily cycle for minute or hour data or a weekly cycle for daily data</li>
<li>
<strong>Trend Components</strong>: Longer term growth that happens over many observations.</li>
</ul>
<p>Therefore, the first objective is to generate remainders from a time series. Some analysis techniques are better for this task then others, and it’s probably not the ones you would think.</p>
<p>There are many ways that a time series can be deconstructed to produce residuals. We have tried many including using ARIMA, Machine Learning (Regression), Seasonal Decomposition, and so on. For anomaly detection, we have seen the best performance using <strong>seasonal decomposition</strong>. Most high performance machine learning techniques perform poorly for anomaly detection because of <em>overfitting</em>, which downplays the difference between the actual value and the fitted value. This is not the objective of anomaly detection wherein we need to highlight the anomaly. Seasonal decomposition does very well for this task, removing the right features (i.e. seasonal and trend components) while preserving the characteristics of anomalies in the residuals.</p>
<p>The <code>anomalize</code> package implements two techniques for seasonal decomposition:</p>
<ol style="list-style-type: decimal">
<li>
<strong>STL</strong>: Seasonal Decomposition of Time Series by Loess</li>
<li>
<strong>Twitter</strong>: Seasonal Decomposition of Time Series by Median</li>
</ol>
<p>Each method has pros and cons.</p>
<div id="a--stl" class="section level3">
<h3 class="hasAnchor">
<a href="#a--stl" class="anchor"></a>1.A. STL</h3>
<p>The STL method uses the <code><a href="https://rdrr.io/r/stats/stl.html">stl()</a></code> function from the <code>stats</code> package. STL works very well in circumstances where a long term trend is present. The Loess algorithm typically does a very good job at detecting the trend. However, it circumstances when the seasonal component is more dominant than the trend, Twitter tends to perform better.</p>
</div>
<div id="b--twitter" class="section level3">
<h3 class="hasAnchor">
<a href="#b--twitter" class="anchor"></a>1.B. Twitter</h3>
<p>The Twitter method is a similar decomposition method to that used in Twitter’s <code>AnomalyDetection</code> package. The Twitter method works identically to STL for removing the seasonal component. The main difference is in removing the trend, which is performed by removing the median of the data rather than fitting a smoother. The median works well when a long-term trend is less dominant that the short-term seasonal component. This is because the smoother tends to overfit the anomalies.</p>
</div>
<div id="c--comparison-of-stl-and-twitter-decomposition-methods" class="section level3">
<h3 class="hasAnchor">
<a href="#c--comparison-of-stl-and-twitter-decomposition-methods" class="anchor"></a>1.C. Comparison of STL and Twitter Decomposition Methods</h3>
<p>Load two libraries to perform the comparison.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(anomalize)</a></code></pre></div>
<p>Collect data on the daily downloads of the <code>lubridate</code> package. This comes from the data set, <code>tidyverse_cran_downloads</code> that is part of <code>anomalize</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Data on `lubridate` package daily downloads</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">lubridate_download_history &lt;-<span class="st"> </span>tidyverse_cran_downloads <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(package <span class="op">==</span><span class="st"> "lubridate"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">    </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co"># Output first 10 observations</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">lubridate_download_history <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="st">    </span><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="st">    </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">date</th>
<th align="right">count</th>
<th align="left">package</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2017-01-01</td>
<td align="right">643</td>
<td align="left">lubridate</td>
</tr>
<tr class="even">
<td align="left">2017-01-02</td>
<td align="right">1350</td>
<td align="left">lubridate</td>
</tr>
<tr class="odd">
<td align="left">2017-01-03</td>
<td align="right">2940</td>
<td align="left">lubridate</td>
</tr>
<tr class="even">
<td align="left">2017-01-04</td>
<td align="right">4269</td>
<td align="left">lubridate</td>
</tr>
<tr class="odd">
<td align="left">2017-01-05</td>
<td align="right">3724</td>
<td align="left">lubridate</td>
</tr>
<tr class="even">
<td align="left">2017-01-06</td>
<td align="right">2326</td>
<td align="left">lubridate</td>
</tr>
<tr class="odd">
<td align="left">2017-01-07</td>
<td align="right">1107</td>
<td align="left">lubridate</td>
</tr>
<tr class="even">
<td align="left">2017-01-08</td>
<td align="right">1058</td>
<td align="left">lubridate</td>
</tr>
<tr class="odd">
<td align="left">2017-01-09</td>
<td align="right">2494</td>
<td align="left">lubridate</td>
</tr>
<tr class="even">
<td align="left">2017-01-10</td>
<td align="right">3237</td>
<td align="left">lubridate</td>
</tr>
</tbody>
</table>
<p>We can visualize the differences between the two decomposition methods.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># STL Decomposition Method</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">p1 &lt;-<span class="st"> </span>lubridate_download_history <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/time_decompose.html">time_decompose</a></span>(count, </a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                   <span class="dt">method    =</span> <span class="st">"stl"</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                   <span class="dt">frequency =</span> <span class="st">"1 week"</span>,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">                   <span class="dt">trend     =</span> <span class="st">"3 months"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="st">    </span><span class="kw"><a href="../reference/anomalize.html">anomalize</a></span>(remainder) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="st">    </span><span class="kw"><a href="../reference/plot_anomaly_decomposition.html">plot_anomaly_decomposition</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">"STL Decomposition"</span>)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; frequency = 7 days</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; trend = 91 days</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co"># Twitter Decomposition Method</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">p2 &lt;-<span class="st"> </span>lubridate_download_history <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="st">    </span><span class="kw"><a href="../reference/time_decompose.html">time_decompose</a></span>(count, </a>
<a class="sourceLine" id="cb3-16" data-line-number="16">                   <span class="dt">method    =</span> <span class="st">"twitter"</span>,</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">                   <span class="dt">frequency =</span> <span class="st">"1 week"</span>,</a>
<a class="sourceLine" id="cb3-18" data-line-number="18">                   <span class="dt">trend     =</span> <span class="st">"3 months"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="st">    </span><span class="kw"><a href="../reference/anomalize.html">anomalize</a></span>(remainder) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="st">    </span><span class="kw"><a href="../reference/plot_anomaly_decomposition.html">plot_anomaly_decomposition</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">"Twitter Decomposition"</span>)</a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="co">#&gt; frequency = 7 days</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="co">#&gt; median_span = 85 days</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"></a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="co"># Show plots</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26">p1</a>
<a class="sourceLine" id="cb3-27" data-line-number="27">p2</a></code></pre></div>
<p><img src="anomalize_methods_files/figure-html/unnamed-chunk-3-1.png" width="700"><img src="anomalize_methods_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<p>We can see that the season components for both STL and Twitter decomposition are exactly the same. The difference is the trend component:</p>
<ul>
<li><p>STL: The STL trend follows a smoothed Loess with a Loess trend window at 91 days (as defined by <code>trend = "3 months"</code>). The remainder of the decomposition is centered.</p></li>
<li><p>Twitter: The Twitter trend is a series of medians that are removed. The median span logic is such that the medians are selected to have equal distribution of observations. Because of this, the trend span is 85 days, which is slightly less than the 91 days (or 3 months).</p></li>
</ul>
</div>
<div id="d--transformations" class="section level3">
<h3 class="hasAnchor">
<a href="#d--transformations" class="anchor"></a>1.D. Transformations</h3>
<p>In certain circumstances such as multiplicative trends in which the residuals (remainders) have heteroskedastic properties, which is when the variance changes as the time series sequence progresses (e.g. the remainders fan out), it becomes difficult to detect anomalies in especially in the low variance regions. Logarithmic or power transformations can help in these situations. This is beyond the scope of the methods and is not implemented in the current version of <code>anomalize</code>. However, these transformations can be performed on the incoming target and the output can be inverse-transformed.</p>
</div>
</div>
<div id="detecting-anomalies-in-the-remainders" class="section level2">
<h2 class="hasAnchor">
<a href="#detecting-anomalies-in-the-remainders" class="anchor"></a>2. Detecting Anomalies in the Remainders</h2>
<p>Once a time series analysis is completed and the remainder has the desired characteristics, the remainders can be analyzed. The challenge is that anomalies are high leverage points that distort the distribution. The <code>anomalize</code> package implements two methods that are resistant to the high leverage points:</p>
<ol style="list-style-type: decimal">
<li>
<strong>IQR</strong>: Inner Quartile Range</li>
<li>
<strong>GESD</strong>: Generalized Extreme Studentized Deviate Test</li>
</ol>
<p>Both methods have pros and cons.</p>
<div id="a--iqr" class="section level3">
<h3 class="hasAnchor">
<a href="#a--iqr" class="anchor"></a>2.A. IQR</h3>
<p>The IQR method is a similar method to that used in the <code>forecast</code> package for anomaly removal within the <code>tsoutliers()</code> function. It takes a distribution and uses the 25% and 75% inner quartile range to establish the distribution of the remainder. Limits are set by default to a factor of 3X above and below the inner quartile range, and any remainders beyond the limits are considered anomalies.</p>
<p>The <code>alpha</code> parameter adjusts the 3X factor. By default, <code>alpha = 0.05</code> for consistency with the GESD method. An <code>alpha = 0.025</code>, results in a 6X factor, expanding the limits and making it more difficult for data to be an anomaly. Conversely, an <code>alpha = 0.10</code> contracts the limits to a factor of 1.5X making it more easy for data to be an anomaly.</p>
<p>The IQR method does not depend on any loops and is therefore faster and more easily scaled than the GESD method. However, it may not be as accurate in detecting anomalies since the high leverage anomalies can skew the centerline (median) of the IQR.</p>
</div>
<div id="b--gesd" class="section level3">
<h3 class="hasAnchor">
<a href="#b--gesd" class="anchor"></a>2.B. GESD</h3>
<p>The GESD method is used in Twitter’s <code>AnomalyDetection</code> package. It involves an iterative evaluation of the Generalized Extreme Studentized Deviate test, which progressively evaluates anomalies, removing the worst offenders and recalculating the test statistic and critical value. The critical values progressively contract as more high leverage points are removed.</p>
<p>The <code>alpha</code> parameter adjusts the width of the critical values. By default, <code>alpha = 0.05</code>.</p>
<p>The GESD method is iterative, and therefore more expensive that the IQR method. The main benefit is that GESD is less resistant to high leverage points since the distribution of the data is progressively analyzed as anomalies are removed.</p>
</div>
<div id="c-comparison-of-iqr-and-gesd-methods" class="section level3">
<h3 class="hasAnchor">
<a href="#c-comparison-of-iqr-and-gesd-methods" class="anchor"></a>2.C Comparison of IQR and GESD Methods</h3>
<p>We can generate anomalous data to illustrate how each method work compares to each other.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Generate anomalies</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">idx_outliers    &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="dv">100</span>, <span class="dt">size =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">x[idx_outliers] &lt;-<span class="st"> </span>x[idx_outliers] <span class="op">+</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co"># Visualize simulated anomalies</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="kw">qplot</span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(x), x, </a>
<a class="sourceLine" id="cb4-9" data-line-number="9">      <span class="dt">main =</span> <span class="st">"Simulated Anomalies"</span>,</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">      <span class="dt">xlab =</span> <span class="st">"Index"</span>) </a></code></pre></div>
<p><img src="anomalize_methods_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Two functions power <code><a href="../reference/anomalize.html">anomalize()</a></code>, which are <code><a href="../reference/anomalize_methods.html">iqr()</a></code> and <code><a href="../reference/anomalize_methods.html">gesd()</a></code>. We can use these intermediate functions to illustrate the anomaly detection characteristics.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Analyze outliers: Outlier Report is available with verbose = TRUE</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">iqr_outliers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/anomalize_methods.html">iqr</a></span>(x, <span class="dt">alpha =</span> <span class="fl">0.05</span>, <span class="dt">max_anoms =</span> <span class="fl">0.2</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)<span class="op">$</span>outlier_report</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">gesd_outliers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/anomalize_methods.html">gesd</a></span>(x, <span class="dt">alpha =</span> <span class="fl">0.05</span>, <span class="dt">max_anoms =</span> <span class="fl">0.2</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)<span class="op">$</span>outlier_report</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co"># ploting function for anomaly plots</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">ggsetup &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">    data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(rank, value, <span class="dt">color =</span> outlier)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="st">        </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="st">        </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> limit_upper), <span class="dt">color =</span> <span class="st">"red"</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="st">        </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> limit_lower), <span class="dt">color =</span> <span class="st">"red"</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="st">        </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> index), <span class="dt">vjust =</span> <span class="fl">-1.25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="st">        </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="st">        </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"No"</span> =<span class="st"> "#2c3e50"</span>, <span class="st">"Yes"</span> =<span class="st"> "#e31a1c"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="st">        </span><span class="kw">expand_limits</span>(<span class="dt">y =</span> <span class="dv">13</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="st">        </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>)</a>
<a class="sourceLine" id="cb5-18" data-line-number="18">}</a>
<a class="sourceLine" id="cb5-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb5-20" data-line-number="20"></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co"># Visualize</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22">p3 &lt;-<span class="st"> </span>iqr_outliers <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="st">    </span><span class="kw">ggsetup</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">"IQR: Top outliers sorted by rank"</span>) </a>
<a class="sourceLine" id="cb5-25" data-line-number="25"></a>
<a class="sourceLine" id="cb5-26" data-line-number="26">p4 &lt;-<span class="st"> </span>gesd_outliers <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="st">    </span><span class="kw">ggsetup</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">"GESD: Top outliers sorted by rank"</span>) </a>
<a class="sourceLine" id="cb5-29" data-line-number="29">    </a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="co"># Show plots</span></a>
<a class="sourceLine" id="cb5-31" data-line-number="31">p3</a>
<a class="sourceLine" id="cb5-32" data-line-number="32">p4</a></code></pre></div>
<p><img src="anomalize_methods_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"><img src="anomalize_methods_files/figure-html/unnamed-chunk-5-2.png" width="480" style="display: block; margin: auto;"></p>
<p>We can see that the IQR limits don’t vary whereas the GESD limits get more stringent as anomalies are removed from the data. As a result, the GESD method tends to be more accurate in detecting anomalies at the expense of incurring more processing time for the looped anomaly removal. This expense is most noticeable with larger data sets (many observations or many time series).</p>
</div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>3. Conclusion</h2>
<p>The <code>anomalize</code> package implements several useful and accurate techniques for implementing anomaly detection. The user should now have a better understanding of how the algorithms work along with the strengths and weaknesses of each method.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>4. References</h2>
<ol style="list-style-type: decimal">
<li><p><a href="https://stats.stackexchange.com/questions/69874/how-to-correct-outliers-once-detected-for-time-series-data-forecasting">How to correct outliers once detected for time series data forecasting? Cross Validated, https://stats.stackexchange.com</a></p></li>
<li><p><a href="https://stats.stackexchange.com/questions/1142/simple-algorithm-for-online-outlier-detection-of-a-generic-time-series?">Cross Validated: Simple algorithm for online outlier detection of a generic time series. Cross Validated, https://stats.stackexchange.com</a></p></li>
<li><p><a href="https://www.usenix.org/system/files/conference/hotcloud14/hotcloud14-vallis.pdf">Owen S. Vallis, Jordan Hochenbaum and Arun Kejariwal (2014). A Novel Technique for Long-Term Anomaly Detection in the Cloud. Twitter Inc.</a></p></li>
<li><p><a href="https://github.com/twitter/AnomalyDetection">Owen S. Vallis, Jordan Hochenbaum and Arun Kejariwal (2014). AnomalyDetection: Anomaly Detection Using Seasonal Hybrid Extreme Studentized Deviate Test. R package version 1.0.</a></p></li>
<li><p><a href="https://www.astm.org/standardization-news/images/nd15/nd15_datapoints.pdf">Alex T.C. Lau (November/December 2015). GESD - A Robust and Effective Technique for Dealing with Multiple Outliers. ASTM Standardization News. www.astm.org/sn</a></p></li>
</ol>
</div>
<div id="interested-in-learning-anomaly-detection" class="section level1">
<h1 class="hasAnchor">
<a href="#interested-in-learning-anomaly-detection" class="anchor"></a>Interested in Learning Anomaly Detection?</h1>
<p>Business Science offers two 1-hour courses on Anomaly Detection:</p>
<ul>
<li><p><a href="https://university.business-science.io/p/learning-labs-pro">Learning Lab 18</a> - Time Series Anomaly Detection with <code>anomalize</code></p></li>
<li><p><a href="https://university.business-science.io/p/learning-labs-pro">Learning Lab 17</a> - Anomaly Detection with <code>H2O</code> Machine Learning</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#generating-time-series-analysis-remainders">1. Generating Time Series Analysis Remainders</a></li>
      <li><a href="#detecting-anomalies-in-the-remainders">2. Detecting Anomalies in the Remainders</a></li>
      <li><a href="#conclusion">3. Conclusion</a></li>
      <li><a href="#references">4. References</a></li>
      <li><a href="#interested-in-learning-anomaly-detection">Interested in Learning Anomaly Detection?</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
